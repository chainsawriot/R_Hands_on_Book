---
title: "Die Bestimmung der Zentrale Tendenz mittels t-Tests"
author: "Katharina Maubach"
toc: true
number-sections: true
highlight-style: pygments
format:
  html:
    code-fold: false
    code-line-numbers: true
    code-annotations: hover
execute:
  echo: true
  message: false
  warning: false
---

# Grundlagen der t-tests und deren Durchführung in R

Grundsätzlich unterscheiden wir zwischen drei verschiedenen Arten von t-tests:

-   Einstichprobentest (one-sample-test),
-   t-Test für unabhängige Stichproben (two-paired-test) sowie
-   t-Test für verbundene Stichprobene (paired test)

**Der Einstichprobentest**

Der Einstichprobentest oder auch one-sample-test vergleicht den Mittelwert einer Gruppe mit einem bereits bekannten feststehenden Wert. Wir können so beispielsweise überprüfen, ob das Einkommen in einer Stichprobe dem deutschlandweiten Mittelwert entspricht, sofern dieser uns vorab bekannt ist. 

**t-test für unabhängige Stichproben**

Mit dem t-test für unabhängige Stichproben überprüfen wir, ob sich die Mittelwerte in zwei gemessenen Stichproben unterscheiden. So könnten wir beispielsweise testen, ob sich das Einkommen von Männern und Frauen unterscheidet.    

**t-test für verbundene Stichproben**


## Laden der Daten und benötigten Pakete

Wir beginnen zunächst mit der Vorbereitung und Laden die notwendigen Pakete.

```{r Pakete}
if(!require("pacman")) {install.packages("pacman");library(pacman)}
p_load(tidyverse, ggplot2, haven, mosaic, knitr,effectsize, car, broom) # <1>
theme_set(theme_classic()) # <2>
```

1.  Mittels p_load laden wir alle benötigten Pakete gleichzeitig.
2.  Wir legen allgemein den Hintergrund theme_classic fest.

Anschließend laden wir die Daten aus dem Allbus:

```{r Laden der Daten}
daten = haven::read_dta("Datensatz/Allbus_2021.dta")
```

## Datenmanagement

Um mit dem Datensatz zu arbeiten benötigen wir einige grundlegende Schritte des Datenmanagements [für ausführliche Erklärungen siehe hier](https://patrickzerrer.github.io/R_Hands_on_Book/Skript_3.3.html). Für unseren t-test möchten wir uns anschauen, wie sich das Geschlecht der Befragten auf ihr Vertrauen in XX auswirkt.

```{r}

dat <- daten %>% 
  filter(., sex == 1 | sex == 2) %>%  #>1
  rename(., trustpol = pt15) #>2

```
1. Wir filtern die Fälle, sodass alle Befragten entweder 1=männlich oder 2=weiblich sind.
2. Die Variable Vertrauen in die Polizei(pt15) benennen wir in trustpol

## Deskriptives

```{r}
# Deskription der Abhängigen Variablen
#des_stat <- (favstats(AV ~ UV, data = daten))
#kable (des_stat,
#      col.names = c(label_UV,"Minimum", "1.Quartil", 
#                    "Median", "3.Quartil", 
#                    "Maximum", "M", "SD", "N",
#                    "Fehlend"),
#      digits = 2)
```


# t-Test für Einstichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung
:::

## Durchführung des t-tests für Einstichproben

## Nicht-parametrischer Test:

# t-Test für unabhängige Stichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung

# Voraussetzungen überprüfen
## Skalierung der UV und AV
daten %>% 
  select(UV, AV) %>% 
  lapply(class)

## Normalverteilung der AV 
daten %>%
  group_by(UV) %>% 
  do(tidy(shapiro.test(.$AV)))

## Varianzhomogenität
daten %>% 
  drop_na(UV, AV) %>%
  leveneTest(AV~UV, data = .)

```{r include=F }

```

:::

## Durchführung des t-Tests

```{r include = F}

# t-Test durchführen
dat %>% 
  drop_na(sex, trustpol) %>%
  t.test(trustpol~sex,
         alternative = "two.sided", 
         var.equal = T,
         data = .)
  
# Effektstärke cohens d berechnen
dat %>% 
  drop_na(sex, trustpol) %>% 
  cohens_d(trustpol~sex, data = .)
```

## Interpretation des Outputs


+ was sehen wir?

+ was bedeutet das?

::: callout-tip
## Wie gebe ich die Ergebnisse korrekt an?

Die Ergebnisse des t-tests werden üblicherweise im Text angegeben. Für diese Angabe werden die folgenden Informationen benötigt:

✅ die Werte des Kaiser-Meyer-Olkin Kritierums (KMO)


Das Format ist üblicherweise:

> ***Beispiel:*** Zunächst wurde Faktorenanalyse der 15 gemessenen Indikatoren durchgeführt. Das Kaiser-Meyer-Olkin (KMO)-Maß für die Stichprobenadäquanz betrug 0,89. Dies deutet darauf hin, dass die Korrelationsmuster relativ kompakt sind und die Faktorenanalyse eindeutige und zuverlässige Faktoren ergeben sollte. Der Bartlett-Test auf Sphärizität war ebenfalls signifikant (χ2(105) = 33164.76, p \< .001). Dies bedeutet, dass es einige Beziehungen zwischen den untersuchten Variablen gibt. Sowohl der KMO-Test als auch der Bartlett-Test bestätigen, dass die Faktorenanalyse angemessen ist.
:::

## Nicht-parametrischer Test: Mann-Whitney-U & Wilcoxon-Test

[Historie der Testverfahren](http://www.regorz-statistik.de/inhalte/tutorial_wilcoxon_mann_whitney_u_test.html)


# t-Test für verbundene Stichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung
:::


## Durchführung des t-tests für verbundene Stichproben


## Nicht-parametrischer Test: Wilcoxon-Vorzeichen-Rangtest


