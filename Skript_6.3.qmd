---
title: "Die Bestimmung der Zentrale Tendenz mittels t-Tests"
author: "Katharina Maubach"
toc: true
number-sections: true
highlight-style: pygments
format:
  html:
    code-fold: false
    code-line-numbers: true
    code-annotations: hover
execute:
  echo: true
  message: false
  warning: false
---

# Grundlagen der t-tests und deren Durchführung in R

Grundsätzlich unterscheiden wir zwischen drei verschiedenen Arten von t-tests:

-   Einstichprobentest (one-sample-test),
-   t-Test für unabhängige Stichproben (two-paired-test) sowie
-   t-Test für verbundene Stichprobene (paired test)

**Der Einstichprobentest**

Der Einstichprobentest oder auch one-sample-test vergleicht den Mittelwert einer Gruppe mit einem bereits bekannten feststehenden Wert. Wir können so beispielsweise überprüfen, ob das Einkommen in einer Stichprobe dem deutschlandweiten Mittelwert entspricht, sofern dieser uns vorab bekannt ist.

**t-test für unabhängige Stichproben**

Mit dem t-test für unabhängige Stichproben überprüfen wir, ob sich die Mittelwerte in zwei gemessenen Stichproben unterscheiden. So könnten wir beispielsweise testen, ob sich das Einkommen von Männern und Frauen unterscheidet. Ein anderes typisches Anwendungsbespiel ist der Vergleich von zwei Gruppen im Rahmen eines Experimentaldesign. 

**t-test für verbundene Stichproben**

Der t-test für verbundene Stichproben wiederum misst, inwwiefern sich Mittelwerte bei denselben Personen oder Fällen verändern. 

## Laden der Daten und benötigten Pakete

Wir beginnen zunächst mit der Vorbereitung und Laden die notwendigen Pakete.

```{r Pakete}
if(!require("pacman")) {install.packages("pacman");library(pacman)}
p_load(tidyverse, ggplot2, haven, mosaic, knitr,effectsize, car, broom) # <1>
theme_set(theme_classic()) # <2>
```

1.  Mittels p_load laden wir alle benötigten Pakete gleichzeitig.
2.  Wir legen allgemein den Hintergrund theme_classic fest.

Anschließend laden wir die Daten aus dem Allbus:

```{r Laden der Daten}
daten = haven::read_dta("Datensatz/Allbus_2021.dta")
```

## Datenmanagement

Um mit dem Datensatz zu arbeiten benötigen wir einige grundlegende Schritte des Datenmanagements [für ausführliche Erklärungen siehe hier](https://patrickzerrer.github.io/R_Hands_on_Book/Skript_3.3.html). Für unseren t-test möchten wir uns anschauen, wie sich der Wohnort der Befragten auf ihr Vertrauen in die Bundesregierung auswirkt. Wir nutzen dazu die folgenden Variablen


+----------+----------------------------------+-------------------------------+
| Variable | Beschreibung                     | Ausprägungen                  |
+:========:+:================================:+:=============================:+
| eastwest | Erhebungsgebiet West-Ost         | 1= Alte Bundesländer (Westen) |
|          |                                  |                               |
|          |                                  | 2 = Neue Bundesländer (Osten) |
+----------+----------------------------------+-------------------------------+
| pt12     | Vertrauen in die Bundesregierung | -42 = Datenfehler             |
|          |                                  |                               |
|          |                                  | -11 = TNZ Split               |
|          |                                  |                               |
|          |                                  | -9 = Keine Angabe             |
|          |                                  |                               |
|          |                                  | 1 = Gar kein Vertrauen        |
|          |                                  |                               |
|          |                                  | ...                           |
|          |                                  |                               |
|          |                                  | 7 = Großes Vertrauen          |
+----------+----------------------------------+-------------------------------+

Innerhalb unseres Datenmanageements schließen wir fehlerhafte und fehlende Werte der Variablen pt12 aus und benennen diese anschließend um: 

```{r}

data <- daten %>%
  filter(., pt12 > 0) %>% 
  rename(., trustreg = pt12)
```

## Deskriptives der abhängigen Variablen

```{r}


des_stat <- (favstats(trustreg ~ eastwest, data = data))
des_stat
kable(des_stat,
      col.names = c("Vertrauen in die Bundesregierung","Minimum", "1.Quartil", 
                    "Median", "3.Quartil", 
                    "Maximum", "M", "SD", "N",
                    "Fehlend"),
      digits = 2)

```

# t-Test für Einstichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung
:::

## Durchführung des t-tests für Einstichproben

## Nicht-parametrischer Test:

# t-Test für unabhängige Stichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung

# Voraussetzungen überprüfen

## Skalierung der UV und AV

daten %\>% select(UV, AV) %\>% lapply(class)

## Normalverteilung der AV

daten %\>% group_by(UV) %\>% do(tidy(shapiro.test(.\$AV)))

## Varianzhomogenität

daten %\>% drop_na(UV, AV) %\>% leveneTest(AV\~UV, data = .)

```{r include=F }

```
:::

## Durchführung des t-Tests

```{r}

# t-Test durchführen
data %>% 
  drop_na(eastwest, trustreg) %>%
  filter(.,trustreg >0) %>% 
  t.test(trustreg ~ eastwest,
         alternative = "two.sided", 
         var.equal = T,
         data = .)




table(dat$pt14)


  
# Effektstärke cohens d berechnen
dat %>% 
  drop_na(sex, trustpol) %>% 
  cohens_d(trustpol~sex, data = .)
```

## Interpretation des Outputs

-   was sehen wir?

-   was bedeutet das?

::: callout-tip
## Wie gebe ich die Ergebnisse korrekt an?

Die Ergebnisse des t-tests werden üblicherweise im Text angegeben. Für diese Angabe werden die folgenden Informationen benötigt:

✅ die Werte des Kaiser-Meyer-Olkin Kritierums (KMO)

Das Format ist üblicherweise:

> ***Beispiel:*** Zunächst wurde Faktorenanalyse der 15 gemessenen Indikatoren durchgeführt. Das Kaiser-Meyer-Olkin (KMO)-Maß für die Stichprobenadäquanz betrug 0,89. Dies deutet darauf hin, dass die Korrelationsmuster relativ kompakt sind und die Faktorenanalyse eindeutige und zuverlässige Faktoren ergeben sollte. Der Bartlett-Test auf Sphärizität war ebenfalls signifikant (χ2(105) = 33164.76, p \< .001). Dies bedeutet, dass es einige Beziehungen zwischen den untersuchten Variablen gibt. Sowohl der KMO-Test als auch der Bartlett-Test bestätigen, dass die Faktorenanalyse angemessen ist.
:::

## Nicht-parametrischer Test: Mann-Whitney-U & Wilcoxon-Test

[Historie der Testverfahren](http://www.regorz-statistik.de/inhalte/tutorial_wilcoxon_mann_whitney_u_test.html)

# t-Test für verbundene Stichproben

::: {.callout-note collapse="true" icon="false"}
## Voraussetzungsprüfung
:::

## Durchführung des t-tests für verbundene Stichproben

## Nicht-parametrischer Test: Wilcoxon-Vorzeichen-Rangtest
